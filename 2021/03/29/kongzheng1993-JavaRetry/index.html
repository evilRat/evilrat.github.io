<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>Java Retry | Evil</title>
  <meta name="keywords" content=" Spring ">
  <meta name="description" content="Java Retry | Evil">
  <script data-ad-client="ca-pub-8990321486053761" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta name="baidu_union_verify" content="3b2f522004782a6f88e3aa9bb4df0854">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="1. 主要特性 mongoDB的数据模型是面向文档的  不像关系型数据库，每张表都有严格定义的Schema，规定了列和类型。mongoDB没有Schema，特别适合项目初期使用（表设计经常变化）。  支持即时查询。  二级索引。MongoDB中的二级索引也是用B树实现的。每个集合最多可以创建64个索引。它支持能在RDBMS中找到的各种索引，升序、降序、唯一性、复合键索引，甚至地理空间索引都支持。因">
<meta name="keywords" content="MongoDB">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB笔记">
<meta property="og:url" content="https://kongzheng1993.github.io/2022/02/25/kongzheng1993-MongoDB/index.html">
<meta property="og:site_name" content="Evil">
<meta property="og:description" content="1. 主要特性 mongoDB的数据模型是面向文档的  不像关系型数据库，每张表都有严格定义的Schema，规定了列和类型。mongoDB没有Schema，特别适合项目初期使用（表设计经常变化）。  支持即时查询。  二级索引。MongoDB中的二级索引也是用B树实现的。每个集合最多可以创建64个索引。它支持能在RDBMS中找到的各种索引，升序、降序、唯一性、复合键索引，甚至地理空间索引都支持。因">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://kongzheng1993.github.io/2022/02/25/kongzheng1993-MongoDB/image-20210715174420382.png">
<meta property="og:updated_time" content="2022-02-25T07:46:31.739Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MongoDB笔记">
<meta name="twitter:description" content="1. 主要特性 mongoDB的数据模型是面向文档的  不像关系型数据库，每张表都有严格定义的Schema，规定了列和类型。mongoDB没有Schema，特别适合项目初期使用（表设计经常变化）。  支持即时查询。  二级索引。MongoDB中的二级索引也是用B树实现的。每个集合最多可以创建64个索引。它支持能在RDBMS中找到的各种索引，升序、降序、唯一性、复合键索引，甚至地理空间索引都支持。因">
<meta name="twitter:image" content="https://kongzheng1993.github.io/2022/02/25/kongzheng1993-MongoDB/image-20210715174420382.png">


<link rel="icon" href="/img/avatar.png">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.png" />
</a>
<div class="author">
    <span>evilRat</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/kongzheng1993" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="linkedin" href="https://www.linkedin.com/in/zheng-kong-942411106/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-linkedin"></use>
                </svg>
            
        </a>
        
    
        
        <a title="zhihu" href="https://www.zhihu.com/people/kong-zheng-31-41" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-zhihu"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:kongzheng1993@hotmail.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=767141624&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(129)</small></div></li>
    
        
            
            <li><div data-rel="blog"><i class="fold iconfont icon-right"></i>blog<small>(2)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="github"><i class="fold iconfont icon-right"></i>github<small>(1)</small></div>
                            
                                <ul class="sub hide">
                                    
                                    <li><div data-rel="git">git<small>(1)</small></div>
                                    </li>
                                    
                                </ul>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="linux"><i class="fold iconfont icon-right"></i>linux<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="ss">ss<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="suse"><i class="fold iconfont icon-right"></i>suse<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="server"><i class="fold iconfont icon-right"></i>server<small>(1)</small></div>
                            
                                <ul class="sub hide">
                                    
                                    <li><div data-rel="FTP">FTP<small>(1)</small></div>
                                    </li>
                                    
                                </ul>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="编码">编码<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Linux">Linux<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="RSA"><i class="fold iconfont icon-right"></i>RSA<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="SHA"><i class="fold iconfont icon-right"></i>SHA<small>(1)</small></div>
                            
                                <ul class="sub hide">
                                    
                                    <li><div data-rel="加密"><i class="fold iconfont icon-right"></i>加密<small>(1)</small></div>
                                    </li>
                                    
                                </ul>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="quartz"><i class="fold iconfont icon-right"></i>quartz<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="锁"><i class="fold iconfont icon-right"></i>锁<small>(1)</small></div>
                            
                                <ul class="sub hide">
                                    
                                    <li><div data-rel="分布式">分布式<small>(1)</small></div>
                                    </li>
                                    
                                </ul>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="mysql"><i class="fold iconfont icon-right"></i>mysql<small>(5)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="java">java<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="NIO BIO IO">NIO BIO IO<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Java"><i class="fold iconfont icon-right"></i>Java<small>(29)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="并发">并发<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="jvm">jvm<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="MQ">MQ<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="other">other<small>(3)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="node.js">node.js<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="Web">Web<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="RocketMQ">RocketMQ<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Mysql">Mysql<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="SQL">SQL<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="多线程">多线程<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="MySQL"><i class="fold iconfont icon-right"></i>MySQL<small>(4)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="感悟">感悟<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
            <li><div data-rel="others">others<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Ohters">Ohters<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="maven">maven<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="分布式">分布式<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="java">java<small>(4)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="AI">AI<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="vue">vue<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Spring">Spring<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JavaScript">JavaScript<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="SpringBoot">SpringBoot<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="算法">算法<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JDK">JDK<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="分页">分页<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="OS">OS<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="杂谈">杂谈<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JVM">JVM<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="resume">resume<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="jdk">jdk<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="SpringCloud">SpringCloud<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="Spring Cloud">Spring Cloud<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="网络">网络<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Nginx">Nginx<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="MongoDB">MongoDB<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="spring">spring<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="129">
<input type="hidden" id="yelog_site_word_count" value="154.4k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">oop</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">float</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">servlet</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">sample post</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">images</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">test</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">String</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">new</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">catch，try</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">sys</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">sqlplus</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">sql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">re</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">oracle</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">github</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">hexo</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">java</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">reflect</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Class</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">对象，Class对象</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">select</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">distinct</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">group by</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">order by</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">ss</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">console</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">suse</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">server</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">FTP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">mq</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">消息队列</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">编码</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">RSA</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SHA</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">加密</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">签名</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">quartz</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">锁</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">分布式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">mysql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">备份</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">NIO BIO IO</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">职业</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">业务</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">学习</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Guava</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Java</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">jvm</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MQ</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">other</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">node.js</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">RocketMQ</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Mysql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">多线程</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">算法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">tools</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">MySQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">others</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Ohters</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">maven</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">AI</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">blog</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">vue</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Spring</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">JavaScript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">SpringBoot</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">JDK</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">分页</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Windows</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">杂谈</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">JVM</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">resume</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">简历</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">jdk</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">SpringCloud</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">感悟</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Spring Cloud</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">网络</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Nginx</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">并发</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">MongoDB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">spring</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">安全</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a id="top" class="resume "
           href="/2022/01/02/kongzheng1993-resume/"
           data-tag="resume,简历"
           data-author="" >
            <span class="post-title" title="Resume">Resume</span>
            <span class="post-date" title="2022-01-02 00:00:00">2022/01/02</span>
        </a>
        
        <a id="top" class="node.js "
           href="/2020/03/30/kongzheng1993-用nodejs做一个测试api服务/"
           data-tag="node.js"
           data-author="" >
            <span class="post-title" title="用node.js做一个测试api服务">用node.js做一个测试api服务</span>
            <span class="post-date" title="2020-03-30 00:30:52">2020/03/30</span>
        </a>
        
        <a id="top" class="Java "
           href="/2020/03/30/kongzheng1993-一次老代码优化2/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="记一次老代码优化2">记一次老代码优化2</span>
            <span class="post-date" title="2020-03-30 00:30:52">2020/03/30</span>
        </a>
        
        <a id="top" class="网络 "
           href="/2020/04/04/kongzheng1993-TCP三次握手&四次挥手/"
           data-tag="网络"
           data-author="" >
            <span class="post-title" title="TCP三次握手&amp;四次挥手">TCP三次握手&amp;四次挥手</span>
            <span class="post-date" title="2020-04-04 00:30:52">2020/04/04</span>
        </a>
        
        <a id="top" class="Java "
           href="/2020/03/25/kongzheng1993-一次老代码优化/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="记一次老代码优化">记一次老代码优化</span>
            <span class="post-date" title="2020-03-25 00:30:52">2020/03/25</span>
        </a>
        
        <a  class="JDK "
           href="/2022/03/09/kongzheng1993-包装类==的问题/"
           data-tag="JDK"
           data-author="" >
            <span class="post-title" title="包装类“==”的问题">包装类“==”的问题</span>
            <span class="post-date" title="2022-03-09 18:30:52">2022/03/09</span>
        </a>
        
        <a  class="JVM "
           href="/2022/03/05/kongzheng1993-JVM知识点总结/"
           data-tag="JVM"
           data-author="" >
            <span class="post-title" title="JVM知识点总结">JVM知识点总结</span>
            <span class="post-date" title="2022-03-05 18:30:52">2022/03/05</span>
        </a>
        
        <a  class="java "
           href="/2022/03/02/kongzheng1993-DevTools/"
           data-tag="java"
           data-author="" >
            <span class="post-title" title="DevTools的bug">DevTools的bug</span>
            <span class="post-date" title="2022-03-02 18:30:52">2022/03/02</span>
        </a>
        
        <a  class="MongoDB "
           href="/2022/02/25/kongzheng1993-MongoDB/"
           data-tag="MongoDB"
           data-author="" >
            <span class="post-title" title="MongoDB笔记">MongoDB笔记</span>
            <span class="post-date" title="2022-02-25 15:46:31">2022/02/25</span>
        </a>
        
        <a  class="Web "
           href="/2022/01/14/kongzheng1993-jsoup遇到的问题/"
           data-tag="Web"
           data-author="" >
            <span class="post-title" title="使用jsoup遇到的问题">使用jsoup遇到的问题</span>
            <span class="post-date" title="2022-01-14 18:30:52">2022/01/14</span>
        </a>
        
        <a  class="mysql "
           href="/2022/01/09/kongzheng1993-MySQL_MVCC/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL性能优化">MySQL性能优化</span>
            <span class="post-date" title="2022-01-09 18:30:52">2022/01/09</span>
        </a>
        
        <a  class="mysql "
           href="/2022/01/09/kongzheng1993-MySQL性能优化/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL性能优化">MySQL性能优化</span>
            <span class="post-date" title="2022-01-09 18:30:52">2022/01/09</span>
        </a>
        
        <a  class="Spring "
           href="/2021/11/29/kongzheng1993-hs_err_pid_pid_log/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="hs_err_pid_pdi.log分析">hs_err_pid_pdi.log分析</span>
            <span class="post-date" title="2021-11-29 16:30:10">2021/11/29</span>
        </a>
        
        <a  class="Spring "
           href="/2021/11/26/kongzheng1993-mysql_bitMap/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="MySQL位运算实现权限控制">MySQL位运算实现权限控制</span>
            <span class="post-date" title="2021-11-26 16:30:10">2021/11/26</span>
        </a>
        
        <a  class="Spring "
           href="/2021/11/26/kongzheng1993-spring_session/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="Spring Session">Spring Session</span>
            <span class="post-date" title="2021-11-26 16:30:10">2021/11/26</span>
        </a>
        
        <a  class="Spring "
           href="/2021/11/26/kongzheng1993-记一次频繁FullGC解决/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="记一次频繁FullGC问题解决">记一次频繁FullGC问题解决</span>
            <span class="post-date" title="2021-11-26 16:30:10">2021/11/26</span>
        </a>
        
        <a  class="Spring "
           href="/2021/11/26/kongzheng1993-maven_resource_plugin/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="Spring Session">Spring Session</span>
            <span class="post-date" title="2021-11-26 16:30:10">2021/11/26</span>
        </a>
        
        <a  class="Java "
           href="/2021/11/26/kongzheng1993-BigDecimal/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="BigDecimal用法">BigDecimal用法</span>
            <span class="post-date" title="2021-11-26 16:30:10">2021/11/26</span>
        </a>
        
        <a  class="Java "
           href="/2021/11/03/kongzheng1993-Java异常和错误/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java异常和错误">Java异常和错误</span>
            <span class="post-date" title="2021-11-03 16:30:10">2021/11/03</span>
        </a>
        
        <a  class="MySQL 感悟 "
           href="/2021/10/28/kongzheng1993-20211027团队分享会感悟/"
           data-tag="MySQL,感悟"
           data-author="" >
            <span class="post-title" title="20211027团队分享会感悟">20211027团队分享会感悟</span>
            <span class="post-date" title="2021-10-28 23:30:10">2021/10/28</span>
        </a>
        
        <a  class="Spring Cloud "
           href="/2021/10/09/kongzheng1993-Feign_Request_Header_is_too_large/"
           data-tag="Spring Cloud"
           data-author="" >
            <span class="post-title" title="Feign请求Request header is too large">Feign请求Request header is too large</span>
            <span class="post-date" title="2021-10-09 00:30:52">2021/10/09</span>
        </a>
        
        <a  class="Spring "
           href="/2021/10/09/kongzheng1993-Spring启动过程代码跟踪/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="Spring启动过程源码跟踪！">Spring启动过程源码跟踪！</span>
            <span class="post-date" title="2021-10-09 00:30:52">2021/10/09</span>
        </a>
        
        <a  class="Spring "
           href="/2021/10/08/kongzheng1993-Spring是如何解决循环依赖的（三级缓存）/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="Spring是如何解决循环依赖的？">Spring是如何解决循环依赖的？</span>
            <span class="post-date" title="2021-10-08 16:30:10">2021/10/08</span>
        </a>
        
        <a  class="MySQL "
           href="/2021/07/27/kongzheng1993-mysql联表查询字符集不一致不走索引/"
           data-tag="MySQL"
           data-author="" >
            <span class="post-title" title="MySQL联表查询表字符集不一致索引失效问题">MySQL联表查询表字符集不一致索引失效问题</span>
            <span class="post-date" title="2021-07-27 16:30:10">2021/07/27</span>
        </a>
        
        <a  class="Java "
           href="/2021/07/25/kongzheng1993-关于编译/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="关于编译">关于编译</span>
            <span class="post-date" title="2021-07-25 16:30:10">2021/07/25</span>
        </a>
        
        <a  class="SpringCloud "
           href="/2021/07/15/kongzheng1993-feign上传文件/"
           data-tag="SpringCloud"
           data-author="" >
            <span class="post-title" title="feign上传文件">feign上传文件</span>
            <span class="post-date" title="2021-07-15 13:30:10">2021/07/15</span>
        </a>
        
        <a  class="Java "
           href="/2021/07/13/kongzheng1993-泛型/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="泛型">泛型</span>
            <span class="post-date" title="2021-07-13 13:30:10">2021/07/13</span>
        </a>
        
        <a  class="JVM "
           href="/2021/07/04/kongzheng1993-JVM调优/"
           data-tag="JVM"
           data-author="" >
            <span class="post-title" title="JVM调优">JVM调优</span>
            <span class="post-date" title="2021-07-04 13:30:10">2021/07/04</span>
        </a>
        
        <a  class="spring "
           href="/2021/07/01/kongzheng1993-springMVC消息转换器/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="SpringMVC消息转换器">SpringMVC消息转换器</span>
            <span class="post-date" title="2021-07-01 13:30:10">2021/07/01</span>
        </a>
        
        <a  class="杂谈 "
           href="/2021/06/06/kongzheng1993-最近的一些感悟/"
           data-tag="杂谈"
           data-author="" >
            <span class="post-title" title="最近的一些感悟">最近的一些感悟</span>
            <span class="post-date" title="2021-06-06 13:30:10">2021/06/06</span>
        </a>
        
        <a  class="JDK "
           href="/2021/04/29/kongzheng1993-getResource/"
           data-tag="JDK"
           data-author="" >
            <span class="post-title" title="java.lang.Class#getResource浅析">java.lang.Class#getResource浅析</span>
            <span class="post-date" title="2021-04-29 19:30:52">2021/04/29</span>
        </a>
        
        <a  class="Spring "
           href="/2021/03/29/kongzheng1993-JavaRetry/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="Java Retry">Java Retry</span>
            <span class="post-date" title="2021-03-29 19:30:52">2021/03/29</span>
        </a>
        
        <a  class="Java "
           href="/2021/03/27/kongzheng1993-JavaRemoteDebug/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java Remote Debug">Java Remote Debug</span>
            <span class="post-date" title="2021-03-27 19:30:52">2021/03/27</span>
        </a>
        
        <a  class="OS "
           href="/2021/03/26/kongzheng1993-Win10下的wls中git状态不对的问题/"
           data-tag="Linux,Windows"
           data-author="" >
            <span class="post-title" title="Win10下的wls中git状态不对的问题">Win10下的wls中git状态不对的问题</span>
            <span class="post-date" title="2021-03-26 19:30:52">2021/03/26</span>
        </a>
        
        <a  class="Java "
           href="/2021/03/15/kongzheng1993-FeignClient遇到的小问题/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="FeignClient遇到的小问题">FeignClient遇到的小问题</span>
            <span class="post-date" title="2021-03-15 19:30:52">2021/03/15</span>
        </a>
        
        <a  class="Java "
           href="/2021/02/05/kongzheng1993-Vue学习笔记/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Vue学习笔记">Vue学习笔记</span>
            <span class="post-date" title="2021-02-05 19:30:52">2021/02/05</span>
        </a>
        
        <a  class="Java "
           href="/2021/02/02/kongzheng1993-Vue父子组件之间传递参数/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Vue父子组件之间传递参数">Vue父子组件之间传递参数</span>
            <span class="post-date" title="2021-02-02 19:30:52">2021/02/02</span>
        </a>
        
        <a  class="MySQL "
           href="/2021/01/22/kongzheng1993-MySQL技术内幕读书笔记/"
           data-tag="MySQL"
           data-author="" >
            <span class="post-title" title="MySQL技术内幕读书笔记（持续更新）">MySQL技术内幕读书笔记（持续更新）</span>
            <span class="post-date" title="2021-01-22 10:30:52">2021/01/22</span>
        </a>
        
        <a  class="Java "
           href="/2021/01/21/kongzheng1993-Java8Lambda/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java8 Lambda">Java8 Lambda</span>
            <span class="post-date" title="2021-01-21 10:30:52">2021/01/21</span>
        </a>
        
        <a  class="Java "
           href="/2021/01/07/kongzheng1993-包装类型存在的意义/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="包装类存在的意义是什么？">包装类存在的意义是什么？</span>
            <span class="post-date" title="2021-01-07 10:30:52">2021/01/07</span>
        </a>
        
        <a  class="分页 "
           href="/2020/12/29/kongzheng1993-PageHelper/"
           data-tag="分页"
           data-author="" >
            <span class="post-title" title="PageHelper">PageHelper</span>
            <span class="post-date" title="2020-12-29 10:30:52">2020/12/29</span>
        </a>
        
        <a  class="JDK "
           href="/2020/12/29/kongzheng1993-javax.script/"
           data-tag="JDK"
           data-author="" >
            <span class="post-title" title="JDK自带的脚本引擎javax.script.ScriptEngine">JDK自带的脚本引擎javax.script.ScriptEngine</span>
            <span class="post-date" title="2020-12-29 10:30:52">2020/12/29</span>
        </a>
        
        <a  class="Web "
           href="/2020/12/18/kongzheng1993-iframe重复加载的问题/"
           data-tag="Web"
           data-author="" >
            <span class="post-title" title="iframe重复加载的问题">iframe重复加载的问题</span>
            <span class="post-date" title="2020-12-18 19:30:52">2020/12/18</span>
        </a>
        
        <a  class="Web "
           href="/2020/12/18/kongzheng1993-避免浏览器缓存的技巧/"
           data-tag="Web"
           data-author="" >
            <span class="post-title" title="避免浏览器缓存的技巧">避免浏览器缓存的技巧</span>
            <span class="post-date" title="2020-12-18 10:30:52">2020/12/18</span>
        </a>
        
        <a  class="Spring "
           href="/2020/11/11/kongzheng1993-StopWatch/"
           data-tag="Spring"
           data-author="" >
            <span class="post-title" title="你不知道StopWatch吗？">你不知道StopWatch吗？</span>
            <span class="post-date" title="2020-11-11 10:30:52">2020/11/11</span>
        </a>
        
        <a  class="算法 "
           href="/2020/11/11/kongzheng1993-乐观锁实现方式/"
           data-tag="算法"
           data-author="" >
            <span class="post-title" title="乐观锁实现方式">乐观锁实现方式</span>
            <span class="post-date" title="2020-11-11 00:30:52">2020/11/11</span>
        </a>
        
        <a  class="SpringBoot "
           href="/2020/10/23/kongzheng1993-SpringBoot自定义starter/"
           data-tag="SpringBoot"
           data-author="" >
            <span class="post-title" title="SpringBoot自定义starter">SpringBoot自定义starter</span>
            <span class="post-date" title="2020-10-23 00:30:52">2020/10/23</span>
        </a>
        
        <a  class="JavaScript "
           href="/2020/10/21/kongzheng1993-原生js实现双击复制后的思考/"
           data-tag="JavaScript"
           data-author="" >
            <span class="post-title" title="原生js实现双击复制后的思考">原生js实现双击复制后的思考</span>
            <span class="post-date" title="2020-10-21 00:30:52">2020/10/21</span>
        </a>
        
        <a  class="vue "
           href="/2020/10/19/kongzheng1993-Vue.prototype/"
           data-tag="vue"
           data-author="" >
            <span class="post-title" title="Vue.prototype">Vue.prototype</span>
            <span class="post-date" title="2020-10-19 00:30:52">2020/10/19</span>
        </a>
        
        <a  class="Java "
           href="/2020/08/04/kongzheng1993-java调用外部程序/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java调用外部程序">Java调用外部程序</span>
            <span class="post-date" title="2020-08-04 00:30:52">2020/08/04</span>
        </a>
        
        <a  class="分布式 "
           href="/2020/07/26/kongzheng1993-apollo/"
           data-tag="分布式"
           data-author="" >
            <span class="post-title" title="Apollo分布式配置中心">Apollo分布式配置中心</span>
            <span class="post-date" title="2020-07-26 00:30:52">2020/07/26</span>
        </a>
        
        <a  class="other "
           href="/2020/07/11/kongzheng1993-think-in-md-catalog/"
           data-tag="other"
           data-author="" >
            <span class="post-title" title="由一次github README.md引发的思考">由一次github README.md引发的思考</span>
            <span class="post-date" title="2020-07-11 00:30:52">2020/07/11</span>
        </a>
        
        <a  class="blog "
           href="/2020/07/08/kongzheng1993-move-to-csdn/"
           data-tag="blog"
           data-author="" >
            <span class="post-title" title="将博客搬至CSDN">将博客搬至CSDN</span>
            <span class="post-date" title="2020-07-08 00:30:52">2020/07/08</span>
        </a>
        
        <a  class="java "
           href="/2020/07/05/kongzheng1993-Java-rmi/"
           data-tag="java"
           data-author="" >
            <span class="post-title" title="Java RMI">Java RMI</span>
            <span class="post-date" title="2020-07-05 00:30:52">2020/07/05</span>
        </a>
        
        <a  class="AI "
           href="/2020/06/29/kongzheng1993-NLP/"
           data-tag="AI"
           data-author="" >
            <span class="post-title" title="NLP">NLP</span>
            <span class="post-date" title="2020-06-29 00:30:52">2020/06/29</span>
        </a>
        
        <a  class="java "
           href="/2020/05/29/kongzheng1993-Java动态代理/"
           data-tag="java"
           data-author="" >
            <span class="post-title" title="Java动态代理">Java动态代理</span>
            <span class="post-date" title="2020-05-29 00:30:52">2020/05/29</span>
        </a>
        
        <a  class="maven "
           href="/2020/05/22/kongzheng1993-Unicast_Multicast_Broadcast/"
           data-tag="maven"
           data-author="" >
            <span class="post-title" title="单播、多播（组播）、广播">单播、多播（组播）、广播</span>
            <span class="post-date" title="2020-05-22 00:30:52">2020/05/22</span>
        </a>
        
        <a  class="maven "
           href="/2020/05/21/kongzheng1993-maven_install/"
           data-tag="maven"
           data-author="" >
            <span class="post-title" title="记一次Maven冒险">记一次Maven冒险</span>
            <span class="post-date" title="2020-05-21 00:30:52">2020/05/21</span>
        </a>
        
        <a  class="分布式 "
           href="/2020/05/21/kongzheng1993-分布式事务/"
           data-tag="分布式"
           data-author="" >
            <span class="post-title" title="分布式事务">分布式事务</span>
            <span class="post-date" title="2020-05-21 00:30:52">2020/05/21</span>
        </a>
        
        <a  class="Java 并发 "
           href="/2020/05/18/kongzheng1993-ThreadPool总结/"
           data-tag="Java,并发"
           data-author="" >
            <span class="post-title" title="ThreadPool总结">ThreadPool总结</span>
            <span class="post-date" title="2020-05-18 00:30:52">2020/05/18</span>
        </a>
        
        <a  class="Nginx "
           href="/2020/05/12/kongzheng1993-Nginx/"
           data-tag="Nginx"
           data-author="" >
            <span class="post-title" title="Nginx">Nginx</span>
            <span class="post-date" title="2020-05-12 00:30:52">2020/05/12</span>
        </a>
        
        <a  class="others "
           href="/2020/05/12/kongzheng1993-Linux文件句柄/"
           data-tag="others"
           data-author="" >
            <span class="post-title" title="Linux文件句柄">Linux文件句柄</span>
            <span class="post-date" title="2020-05-12 00:30:52">2020/05/12</span>
        </a>
        
        <a  class="SQL "
           href="/2020/05/09/kongzheng1993-数据库设计范式/"
           data-tag="SQL"
           data-author="" >
            <span class="post-title" title="数据库设计范式">数据库设计范式</span>
            <span class="post-date" title="2020-05-09 00:30:52">2020/05/09</span>
        </a>
        
        <a  class="Ohters "
           href="/2020/04/30/kongzheng1993-一次服务器告警的处理/"
           data-tag="Ohters"
           data-author="" >
            <span class="post-title" title="一次服务器告警的处理">一次服务器告警的处理</span>
            <span class="post-date" title="2020-04-30 00:30:52">2020/04/30</span>
        </a>
        
        <a  class="MySQL "
           href="/2020/04/29/kongzheng1993-各种索引/"
           data-tag="MySQL"
           data-author="" >
            <span class="post-title" title="各种索引？">各种索引？</span>
            <span class="post-date" title="2020-04-29 00:30:52">2020/04/29</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/28/kongzheng1993-devtools/"
           data-tag="Java,tools"
           data-author="" >
            <span class="post-title" title="springboot devtools">springboot devtools</span>
            <span class="post-date" title="2020-04-28 00:30:52">2020/04/28</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/27/kongzheng1993-java.lang.IllegalMonitorStateException/"
           data-tag="Java,多线程"
           data-author="" >
            <span class="post-title" title="java.lang.IllegalMonitorStateException">java.lang.IllegalMonitorStateException</span>
            <span class="post-date" title="2020-04-27 00:30:52">2020/04/27</span>
        </a>
        
        <a  class="多线程 "
           href="/2020/04/25/kongzheng1993-死锁/"
           data-tag="多线程"
           data-author="" >
            <span class="post-title" title="死锁">死锁</span>
            <span class="post-date" title="2020-04-25 00:30:52">2020/04/25</span>
        </a>
        
        <a  class="多线程 "
           href="/2020/04/25/kongzheng1993-银行家算法/"
           data-tag="多线程,算法"
           data-author="" >
            <span class="post-title" title="银行家算法">银行家算法</span>
            <span class="post-date" title="2020-04-25 00:30:52">2020/04/25</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/24/kongzheng1993-SPI/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="SPI">SPI</span>
            <span class="post-date" title="2020-04-24 00:30:52">2020/04/24</span>
        </a>
        
        <a  class="SQL "
           href="/2020/04/22/kongzheng1993-SQL优化/"
           data-tag="SQL"
           data-author="" >
            <span class="post-title" title="SQL优化整理">SQL优化整理</span>
            <span class="post-date" title="2020-04-22 00:30:52">2020/04/22</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/21/kongzheng1993-synchronized锁升级/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="synchronized锁升级">synchronized锁升级</span>
            <span class="post-date" title="2020-04-21 00:30:52">2020/04/21</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/20/kongzheng1993-JVM/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="JVM结构">JVM结构</span>
            <span class="post-date" title="2020-04-20 00:30:52">2020/04/20</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/19/kongzheng1993-Java就是值传递的/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java是值传递的！">Java是值传递的！</span>
            <span class="post-date" title="2020-04-19 00:30:52">2020/04/19</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/17/kongzheng1993-Java_Monitor/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java Monitor">Java Monitor</span>
            <span class="post-date" title="2020-04-17 00:30:52">2020/04/17</span>
        </a>
        
        <a  class="Mysql "
           href="/2020/04/17/kongzheng1993-MySQL事务隔离级别/"
           data-tag="Mysql"
           data-author="" >
            <span class="post-title" title="MySQL事务隔离级别">MySQL事务隔离级别</span>
            <span class="post-date" title="2020-04-17 00:30:52">2020/04/17</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/16/kongzheng1993-CAS/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="CAS">CAS</span>
            <span class="post-date" title="2020-04-16 00:30:52">2020/04/16</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/14/kongzheng1993-JavaObjectHeader/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Java对象头">Java对象头</span>
            <span class="post-date" title="2020-04-14 00:30:52">2020/04/14</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/12/kongzheng1993-序列化与反序列化/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="序列化与反序列化">序列化与反序列化</span>
            <span class="post-date" title="2020-04-12 00:30:52">2020/04/12</span>
        </a>
        
        <a  class="RocketMQ "
           href="/2020/04/10/kongzheng1993-OpenMessageing_Example/"
           data-tag="RocketMQ"
           data-author="" >
            <span class="post-title" title="交易消息示例">交易消息示例</span>
            <span class="post-date" title="2020-04-10 00:30:52">2020/04/10</span>
        </a>
        
        <a  class="RocketMQ "
           href="/2020/04/09/kongzheng1993-TransactionMessage/"
           data-tag="RocketMQ"
           data-author="" >
            <span class="post-title" title="RocketMQ OpenMessaging Example">RocketMQ OpenMessaging Example</span>
            <span class="post-date" title="2020-04-09 00:30:52">2020/04/09</span>
        </a>
        
        <a  class="other "
           href="/2020/04/08/kongzheng1993-chromebook再次折腾crouton/"
           data-tag="other"
           data-author="" >
            <span class="post-title" title="chromebook再次折腾crouton">chromebook再次折腾crouton</span>
            <span class="post-date" title="2020-04-08 00:30:52">2020/04/08</span>
        </a>
        
        <a  class="Java "
           href="/2020/04/07/kongzheng1993-Effective_Java学习笔记1/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Effectiv Java学习笔记（一）">Effectiv Java学习笔记（一）</span>
            <span class="post-date" title="2020-04-07 00:30:52">2020/04/07</span>
        </a>
        
        <a  class="Web "
           href="/2020/03/30/kongzheng1993-localStorage/"
           data-tag="Web"
           data-author="" >
            <span class="post-title" title="localStorage">localStorage</span>
            <span class="post-date" title="2020-03-30 00:30:52">2020/03/30</span>
        </a>
        
        <a  class="MQ "
           href="/2020/03/25/kongzheng1993-RocketMQ定时消息示例/"
           data-tag="MQ"
           data-author="" >
            <span class="post-title" title="定时消息示例">定时消息示例</span>
            <span class="post-date" title="2020-03-25 00:30:52">2020/03/25</span>
        </a>
        
        <a  class="Java "
           href="/2020/03/19/kongzheng1993-Thread和Runnable/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Thread和Runnable">Thread和Runnable</span>
            <span class="post-date" title="2020-03-19 00:30:52">2020/03/19</span>
        </a>
        
        <a  class="Java "
           href="/2020/03/19/kongzheng1993-Future/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="Future">Future</span>
            <span class="post-date" title="2020-03-19 00:30:52">2020/03/19</span>
        </a>
        
        <a  class="jvm "
           href="/2020/03/08/kongzheng1993-jhat/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="jhat">jhat</span>
            <span class="post-date" title="2020-03-08 00:30:52">2020/03/08</span>
        </a>
        
        <a  class="jvm "
           href="/2020/03/08/kongzheng1993-jmap/"
           data-tag="jvm"
           data-author="" >
            <span class="post-title" title="jmap">jmap</span>
            <span class="post-date" title="2020-03-08 00:30:52">2020/03/08</span>
        </a>
        
        <a  class="Java "
           href="/2020/03/08/kongzheng1993-Map遍历的几种方法/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="关于Map遍历的几种方法总结">关于Map遍历的几种方法总结</span>
            <span class="post-date" title="2020-03-08 00:30:52">2020/03/08</span>
        </a>
        
        <a  class="Web "
           href="/2020/03/08/kongzheng1993-URLEncode/"
           data-tag="Web"
           data-author="" >
            <span class="post-title" title="URLEncoder">URLEncoder</span>
            <span class="post-date" title="2020-03-08 00:30:52">2020/03/08</span>
        </a>
        
        <a  class="other "
           href="/2020/03/08/kongzheng1993-带你撸一台免费云服务器/"
           data-tag="other"
           data-author="" >
            <span class="post-title" title="带你撸一台免费云服务器">带你撸一台免费云服务器</span>
            <span class="post-date" title="2020-03-08 00:30:52">2020/03/08</span>
        </a>
        
        <a  class="Java "
           href="/2020/03/06/kongzheng1993-Guava/"
           data-tag="Guava"
           data-author="" >
            <span class="post-title" title="Guava">Guava</span>
            <span class="post-date" title="2020-03-06 00:30:52">2020/03/06</span>
        </a>
        
        <a  class="NIO BIO IO "
           href="/2019/09/11/kongzheng1993-NIO&BIO/"
           data-tag="NIO BIO IO"
           data-author="" >
            <span class="post-title" title="NIO&amp;BIO">NIO&amp;BIO</span>
            <span class="post-date" title="2019-09-11 18:30:52">2019/09/11</span>
        </a>
        
        <a  class="mysql "
           href="/2019/09/11/kongzheng1993-MySQL基础/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL基础">MySQL基础</span>
            <span class="post-date" title="2019-09-11 18:30:52">2019/09/11</span>
        </a>
        
        <a  class="jdk "
           href="/2019/08/18/kongzheng1993-HashMap&ConcurrentHashMap/"
           data-tag="jdk"
           data-author="" >
            <span class="post-title" title="HashMap&amp;ConcurrentHashMap">HashMap&amp;ConcurrentHashMap</span>
            <span class="post-date" title="2019-08-18 00:30:52">2019/08/18</span>
        </a>
        
        <a  class="mysql java "
           href="/2019/06/14/kongzheng1993-mysql超过最大连接数-一次生产问题定位/"
           data-tag="java,mysql"
           data-author="" >
            <span class="post-title" title="mysql超过最大连接数一次生产问题定位.md">mysql超过最大连接数一次生产问题定位.md</span>
            <span class="post-date" title="2019-06-14 12:34:44">2019/06/14</span>
        </a>
        
        <a  class=""
           href="/2019/06/13/kongzheng1993-Connect-timed-out与Read-timed-out/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="kongzheng1993-Connect_timed_out与Read_timed_out.md">kongzheng1993-Connect_timed_out与Read_timed_out.md</span>
            <span class="post-date" title="2019-06-13 11:45:08">2019/06/13</span>
        </a>
        
        <a  class="RSA SHA 加密 签名 "
           href="/2019/06/13/kongzheng1993-RSA加密与SHA签名/"
           data-tag="RSA,SHA,加密,签名"
           data-author="" >
            <span class="post-title" title="RSA加密与SHA签名">RSA加密与SHA签名</span>
            <span class="post-date" title="2019-06-13 11:43:52">2019/06/13</span>
        </a>
        
        <a  class="quartz 锁 分布式 "
           href="/2019/06/11/kongzheng1993-关于分布式锁/"
           data-tag="quartz,锁,分布式"
           data-author="" >
            <span class="post-title" title="关于分布式锁.md">关于分布式锁.md</span>
            <span class="post-date" title="2019-06-11 15:48:10">2019/06/11</span>
        </a>
        
        <a  class=""
           href="/2019/06/05/kongzheng1993-关于学习业务的思考/"
           data-tag="职业,业务,学习"
           data-author="" >
            <span class="post-title" title="关于学习业务的思考">关于学习业务的思考</span>
            <span class="post-date" title="2019-06-05 14:02:45">2019/06/05</span>
        </a>
        
        <a  class="Linux "
           href="/2019/06/05/kongzheng1993-nohup和&/"
           data-tag="Linux"
           data-author="" >
            <span class="post-title" title="nohup和&amp;">nohup和&amp;</span>
            <span class="post-date" title="2019-06-05 13:52:46">2019/06/05</span>
        </a>
        
        <a  class=""
           href="/2019/06/04/kongzheng1993-MQ/"
           data-tag="mq,消息队列"
           data-author="" >
            <span class="post-title" title="MQ">MQ</span>
            <span class="post-date" title="2019-06-04 14:36:47">2019/06/04</span>
        </a>
        
        <a  class="编码 "
           href="/2019/05/30/kongzheng1993-生产部署illegal-character/"
           data-tag="编码"
           data-author="" >
            <span class="post-title" title="***.java:[1,1] illegal character">***.java:[1,1] illegal character</span>
            <span class="post-date" title="2019-05-30 00:00:00">2019/05/30</span>
        </a>
        
        <a  class="mysql "
           href="/2018/08/05/kongzheng1993-mysql数据库导出导入/"
           data-tag="mysql,备份"
           data-author="" >
            <span class="post-title" title="mysql数据库导出导入">mysql数据库导出导入</span>
            <span class="post-date" title="2018-08-05 00:00:00">2018/08/05</span>
        </a>
        
        <a  class="java "
           href="/2018/06/08/kongzheng1993-java多线程总结/"
           data-tag="java,多线程,安全"
           data-author="" >
            <span class="post-title" title="java多线程总结">java多线程总结</span>
            <span class="post-date" title="2018-06-08 00:00:00">2018/06/08</span>
        </a>
        
        <a  class="linux ss "
           href="/2018/05/02/kongzheng1993-linux命令行下的ss/"
           data-tag="linux,ss,console"
           data-author="" >
            <span class="post-title" title="linux命令行下的ss">linux命令行下的ss</span>
            <span class="post-date" title="2018-05-02 00:00:00">2018/05/02</span>
        </a>
        
        <a  class="suse server FTP "
           href="/2018/02/01/kongzheng1993-suse_ftp服务配置/"
           data-tag="suse,server,FTP"
           data-author="" >
            <span class="post-title" title="SUSE server FTP配置">SUSE server FTP配置</span>
            <span class="post-date" title="2018-02-01 00:00:00">2018/02/01</span>
        </a>
        
        <a  class="blog github git "
           href="/2018/02/01/kongzheng1993-hexo搭建githubPages/"
           data-tag="github,hexo,git"
           data-author="" >
            <span class="post-title" title="Hexo+github搭建个人博客遇到的问题">Hexo+github搭建个人博客遇到的问题</span>
            <span class="post-date" title="2018-02-01 00:00:00">2018/02/01</span>
        </a>
        
        <a  class=""
           href="/2017/03/08/kongzheng1993-JavaReflect/"
           data-tag="java,reflect,Class,对象，Class对象"
           data-author="" >
            <span class="post-title" title="java反射的学习笔记">java反射的学习笔记</span>
            <span class="post-date" title="2017-03-08 00:00:00">2017/03/08</span>
        </a>
        
        <a  class=""
           href="/2016/07/28/kongzheng1993-method_of_request&response/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="request&amp;response">request&amp;response</span>
            <span class="post-date" title="2016-07-28 00:00:00">2016/07/28</span>
        </a>
        
        <a  class=""
           href="/2016/07/28/kongzheng1993-Properties/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="properties文件的使用">properties文件的使用</span>
            <span class="post-date" title="2016-07-28 00:00:00">2016/07/28</span>
        </a>
        
        <a  class=""
           href="/2016/07/27/kongzheng1993-Session/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="Session笔记">Session笔记</span>
            <span class="post-date" title="2016-07-27 00:00:00">2016/07/27</span>
        </a>
        
        <a  class=""
           href="/2016/07/26/kongzheng1993-centos7_mysql/"
           data-tag="re"
           data-author="" >
            <span class="post-title" title="centos 7 安装mysql遇到的问题">centos 7 安装mysql遇到的问题</span>
            <span class="post-date" title="2016-07-26 00:00:00">2016/07/26</span>
        </a>
        
        <a  class=""
           href="/2016/07/26/kongzheng1993-servlet/"
           data-tag="servlet"
           data-author="" >
            <span class="post-title" title="Servlet">Servlet</span>
            <span class="post-date" title="2016-07-26 00:00:00">2016/07/26</span>
        </a>
        
        <a  class=""
           href="/2016/07/26/kongzheng1993-about_comparator_and_comparable/"
           data-tag="re"
           data-author="" >
            <span class="post-title" title="关于comparator和comparable">关于comparator和comparable</span>
            <span class="post-date" title="2016-07-26 00:00:00">2016/07/26</span>
        </a>
        
        <a  class=""
           href="/2016/07/26/kongzheng1993-请求转发与重定向/"
           data-tag="re"
           data-author="" >
            <span class="post-title" title="请求转发和重定向">请求转发和重定向</span>
            <span class="post-date" title="2016-07-26 00:00:00">2016/07/26</span>
        </a>
        
        <a  class=""
           href="/2016/07/22/kongzheng1993-有关字符串的笔记/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="Java IO">Java IO</span>
            <span class="post-date" title="2016-07-22 00:00:00">2016/07/22</span>
        </a>
        
        <a  class=""
           href="/2016/07/20/kongzheng1993-OracleAfterChangetheNameofComputer/"
           data-tag="oracle"
           data-author="" >
            <span class="post-title" title="修改主机名oracle无法正常启动">修改主机名oracle无法正常启动</span>
            <span class="post-date" title="2016-07-20 00:00:00">2016/07/20</span>
        </a>
        
        <a  class=""
           href="/2016/07/11/kongzheng1993-String_Original/"
           data-tag="String,new"
           data-author="" >
            <span class="post-title" title="String str">String str</span>
            <span class="post-date" title="2016-07-11 00:00:00">2016/07/11</span>
        </a>
        
        <a  class=""
           href="/2016/07/11/kongzheng1993-ablout_try_catch/"
           data-tag="catch，try"
           data-author="" >
            <span class="post-title" title="关于try-catch">关于try-catch</span>
            <span class="post-date" title="2016-07-11 00:00:00">2016/07/11</span>
        </a>
        
        <a  class=""
           href="/2016/07/07/kongzheng1993-DB_Exchange/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="数据库和TXT文件内容的交换">数据库和TXT文件内容的交换</span>
            <span class="post-date" title="2016-07-07 00:00:00">2016/07/07</span>
        </a>
        
        <a  class=""
           href="/2016/07/05/kongzheng1993-PreparedStatement&Statement/"
           data-tag="oop"
           data-author="" >
            <span class="post-title" title="PreparedStatement的优点">PreparedStatement的优点</span>
            <span class="post-date" title="2016-07-05 00:00:00">2016/07/05</span>
        </a>
        
        <a  class=""
           href="/2016/06/13/kongzheng1993-aboutFinal/"
           data-tag="sample post,images,test"
           data-author="" >
            <span class="post-title" title="About the Usage of Final">About the Usage of Final</span>
            <span class="post-date" title="2016-06-13 00:00:00">2016/06/13</span>
        </a>
        
        <a  class=""
           href="/2016/06/10/kongzheng1993-thewayofsort/"
           data-tag="sample post,images,test"
           data-author="" >
            <span class="post-title" title="几种常见的内部排序">几种常见的内部排序</span>
            <span class="post-date" title="2016-06-10 00:00:00">2016/06/10</span>
        </a>
        
        <a  class=""
           href="/2016/06/10/kongzheng1993-about_sqlplus_sys/"
           data-tag="sys,sqlplus,sql"
           data-author="" >
            <span class="post-title" title="使用sys登陆sqlplus的问题">使用sys登陆sqlplus的问题</span>
            <span class="post-date" title="2016-06-10 00:00:00">2016/06/10</span>
        </a>
        
        <a  class=""
           href="/2016/06/10/kongzheng1993-aboutFloat/"
           data-tag="float"
           data-author="" >
            <span class="post-title" title="关于float">关于float</span>
            <span class="post-date" title="2016-06-10 00:00:00">2016/06/10</span>
        </a>
        
        <a  class=""
           href="/2016/06/10/kongzheng1993-oracle/"
           data-tag="sql,select,distinct,group by,order by"
           data-author="" >
            <span class="post-title" title="sql学习笔记">sql学习笔记</span>
            <span class="post-date" title="2016-06-10 00:00:00">2016/06/10</span>
        </a>
        
        <a  class=""
           href="/2016/05/20/kongzheng1993-synchronized/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="synchronized浅析">synchronized浅析</span>
            <span class="post-date" title="2016-05-20 00:00:00">2016/05/20</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-kongzheng1993-JavaRetry" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Java Retry</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="Spring">Spring</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color2">Spring</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2022-02-25 15:46:31'>2021-03-29 19:30</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:6.5k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#系列说明"><span class="toc-text">系列说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#情景导入"><span class="toc-text">情景导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的需求"><span class="toc-text">简单的需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重试"><span class="toc-text">重试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#重试作用"><span class="toc-text">重试作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V1-0-支持重试版本"><span class="toc-text">V1.0 支持重试版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V1-1-代理模式版本"><span class="toc-text">V1.1 代理模式版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V1-2-动态代理模式"><span class="toc-text">V1.2 动态代理模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V1-3-动态代理模式增强"><span class="toc-text">V1.3 动态代理模式增强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V2-0-AOP-实现"><span class="toc-text">V2.0 AOP 实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V3-0-spring-retry-版本"><span class="toc-text">V3.0 spring-retry 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法式使用"><span class="toc-text">方法式使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-retry-结构"><span class="toc-text">spring-retry 结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#guava-retrying"><span class="toc-text">guava-retrying</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#guava-retrying-1"><span class="toc-text">guava-retrying</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#guava-retrying-简介"><span class="toc-text">guava-retrying 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Retry是Spring提供的声明式重试框架。于2.2.0之后从Spring Batch中独立出来。之前用到了spring retry，本来想自己整理下，没想到在网上找到更好的总结，不仅总结了spring retry，而且还是从最简单的while循环的方式开始，到spring retry，再到guava retry，最后自己还搞了一个集二者大成的重试框架。本想搞个链接放在这里，但是怕回头作者博客迁移找不到了。。</p>
<p>以下为原文：<a href="https://blog.51cto.com/9250070/2156431" target="_blank" rel="noopener">java retry(重试) spring retry, guava retrying 详解</a></p>
<h2 id="系列说明"><a href="#系列说明" class="headerlink" title="系列说明"></a>系列说明</h2><p>java retry 的一步步实现机制。</p>
<h2 id="情景导入"><a href="#情景导入" class="headerlink" title="情景导入"></a>情景导入</h2><h3 id="简单的需求"><a href="#简单的需求" class="headerlink" title="简单的需求"></a>简单的需求</h3><p>产品经理：实现一个按条件，查询用户信息的服务。</p>
<p>小明：好的。没问题。</p>
<p>代码: </p>
<ul>
<li>UserService.java</li>
</ul>
<pre><code class="java">public interface UserService {

    /**
     * 根据条件查询用户信息
     * @param condition 条件
     * @return User 信息
     */
    User queryUser(QueryUserCondition condition);

}</code></pre>
<ul>
<li>UserServiceImpl.java</li>
</ul>
<pre><code class="java">public class UserServiceImpl implements UserService {

    private OutService outService;

    public UserServiceImpl(OutService outService) {
        this.outService = outService;
    }

    @Override
    public User queryUser(QueryUserCondition condition) {
        outService.remoteCall();
        return new User();
    }

}</code></pre>
<p>项目经理：这个服务有时候会失败，你看下。</p>
<p>小明：OutService 在是一个 RPC 的外部服务，但是有时候不稳定。</p>
<p>项目经理：如果调用失败了，你可以调用的时候重试几次。你去看下重试相关的东西</p>
<h3 id="重试"><a href="#重试" class="headerlink" title="重试"></a>重试</h3><h4 id="重试作用"><a href="#重试作用" class="headerlink" title="重试作用"></a>重试作用</h4><p>对于重试是有场景限制的，不是什么场景都适合重试，比如参数校验不合法、写操作等（要考虑写是否幂等）都不适合重试。</p>
<p>远程调用超时、网络突然中断可以重试。在微服务治理框架中，通常都有自己的重试与超时配置，比如dubbo可以设置retries=1，timeout=500调用失败只重试1次，超过500ms调用仍未返回则调用失败。</p>
<p>比如外部 RPC 调用，或者数据入库等操作，如果一次操作失败，可以进行多次重试，提高调用成功的可能性。</p>
<h3 id="V1-0-支持重试版本"><a href="#V1-0-支持重试版本" class="headerlink" title="V1.0 支持重试版本"></a>V1.0 支持重试版本</h3><p>思考</p>
<p>小明：我手头还有其他任务，这个也挺简单的。5 分钟时间搞定他。</p>
<p>实现</p>
<ul>
<li>UserServiceRetryImpl.java</li>
</ul>
<pre><code class="java">public class UserServiceRetryImpl implements UserService {

    @Override
    public User queryUser(QueryUserCondition condition) {
        int times = 0;
        OutService outService = new AlwaysFailOutServiceImpl();

        while (times &lt; RetryConstant.MAX_TIMES) {
            try {
                outService.remoteCall();
                return new User();
            } catch (Exception e) {
                times++;

                if(times &gt;= RetryConstant.MAX_TIMES) {
                    throw new RuntimeException(e);
                }
            }
        }

        return null;
    }

}</code></pre>
<h3 id="V1-1-代理模式版本"><a href="#V1-1-代理模式版本" class="headerlink" title="V1.1 代理模式版本"></a>V1.1 代理模式版本</h3><p>易于维护</p>
<p>项目经理：你的代码我看了，功能虽然实现了，但是尽量写的易于维护一点。</p>
<p>小明：好的。(心想，是说要写点注释什么的？)</p>
<p>代理模式</p>
<p>为其他对象提供一种代理以控制对这个对象的访问。</p>
<p>在某些情况下，一个对象不适合或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介作用。</p>
<p>其特征是代理与委托类有同样的接口。</p>
<p>实现</p>
<p>小明想到以前看过的代理模式，心想用这种方式，原来的代码改动量较少，以后想改起来也方便些。</p>
<ul>
<li>UserServiceProxyImpl.java</li>
</ul>
<pre><code class="java">public class UserServiceProxyImpl implements UserService {

    private UserService userService = new UserServiceImpl();

    @Override
    public User queryUser(QueryUserCondition condition) {
        int times = 0;

        while (times &lt; RetryConstant.MAX_TIMES) {
            try {
                return userService.queryUser(condition);
            } catch (Exception e) {
                times++;

                if(times &gt;= RetryConstant.MAX_TIMES) {
                    throw new RuntimeException(e);
                }
            }
        }
        return null;
    }

}</code></pre>
<h3 id="V1-2-动态代理模式"><a href="#V1-2-动态代理模式" class="headerlink" title="V1.2 动态代理模式"></a>V1.2 动态代理模式</h3><p>方便拓展</p>
<p>项目经理：小明啊，这里还有个方法也是同样的问题。你也给加上重试吧。</p>
<p>小明：好的。</p>
<p>小明心想，我在写一个代理，但是转念冷静了下来，如果还有个服务也要重试怎么办呢？</p>
<ul>
<li>RoleService.java</li>
</ul>
<pre><code class="java">public interface RoleService {

    /**
     * 查询
     * @param user 用户信息
     * @return 是否拥有权限
     */
    boolean hasPrivilege(User user);

}</code></pre>
<p>代码实现</p>
<ul>
<li>DynamicProxy.java</li>
</ul>
<pre><code class="java">public class DynamicProxy implements InvocationHandler {

    private final Object subject;

    public DynamicProxy(Object subject) {
        this.subject = subject;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        int times = 0;

        while (times &lt; RetryConstant.MAX_TIMES) {
            try {
                // 当代理对象调用真实对象的方法时，其会自动的跳转到代理对象关联的handler对象的invoke方法来进行调用
                return method.invoke(subject, args);
            } catch (Exception e) {
                times++;

                if (times &gt;= RetryConstant.MAX_TIMES) {
                    throw new RuntimeException(e);
                }
            }
        }

        return null;
    }

    /**
     * 获取动态代理
     *
     * @param realSubject 代理对象
     */
    public static Object getProxy(Object realSubject) {
        //    我们要代理哪个真实对象，就将该对象传进去，最后是通过该真实对象来调用其方法的
        InvocationHandler handler = new DynamicProxy(realSubject);
        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),
                realSubject.getClass().getInterfaces(), handler);
    }

}</code></pre>
<p>测试代码</p>
<pre><code class="java">@Test
public void failUserServiceTest() {
        UserService realService = new UserServiceImpl();
        UserService proxyService = (UserService) DynamicProxy.getProxy(realService);

        User user = proxyService.queryUser(new QueryUserCondition());
        LOGGER.info(&quot;failUserServiceTest: &quot; + user);
}

@Test
public void roleServiceTest() {
        RoleService realService = new RoleServiceImpl();
        RoleService proxyService = (RoleService) DynamicProxy.getProxy(realService);

        boolean hasPrivilege = proxyService.hasPrivilege(new User());
        LOGGER.info(&quot;roleServiceTest: &quot; + hasPrivilege);
}</code></pre>
<h3 id="V1-3-动态代理模式增强"><a href="#V1-3-动态代理模式增强" class="headerlink" title="V1.3 动态代理模式增强"></a>V1.3 动态代理模式增强</h3><p>对话</p>
<p>项目经理：小明，你动态代理的方式是挺会偷懒的，可是我们有的类没有接口。这个问题你要解决一下。</p>
<p>小明：好的。(谁？写服务竟然不定义接口)</p>
<ul>
<li>ResourceServiceImpl.java</li>
</ul>
<pre><code class="java">public class ResourceServiceImpl {

    /**
     * 校验资源信息
     * @param user 入参
     * @return 是否校验通过
     */
    public boolean checkResource(User user) {
        OutService outService = new AlwaysFailOutServiceImpl();
        outService.remoteCall();
        return true;
    }

}</code></pre>
<p>字节码技术</p>
<p>小明看了下网上的资料，解决的办法还是有的。</p>
<p>CGLIB</p>
<p>CGLIB 是一个功能强大、高性能和高质量的代码生成库，用于扩展JAVA类并在运行时实现接口。</p>
<p>javassist</p>
<p>javassist (Java编程助手)使Java字节码操作变得简单。<br>它是Java中编辑字节码的类库;它允许Java程序在运行时定义新类，并在JVM加载类文件时修改类文件。<br>与其他类似的字节码编辑器不同，Javassist提供了两个级别的API:源级和字节码级。<br>如果用户使用源代码级API，他们可以编辑类文件，而不需要了解Java字节码的规范。<br>整个API只使用Java语言的词汇表进行设计。您甚至可以以源文本的形式指定插入的字节码;Javassist动态编译它。<br>另一方面，字节码级API允许用户直接编辑类文件作为其他编辑器。</p>
<p>ASM</p>
<p>ASM 是一个通用的Java字节码操作和分析框架。<br>它可以用来修改现有的类或动态地生成类，直接以二进制形式。<br>ASM提供了一些通用的字节码转换和分析算法，可以从这些算法中构建自定义复杂的转换和代码分析工具。<br>ASM提供与其他Java字节码框架类似的功能，但主要关注性能。<br>因为它的设计和实现都尽可能地小和快，所以非常适合在动态系统中使用(当然也可以以静态的方式使用，例如在编译器中)。</p>
<p>实现</p>
<p>小明看了下，就选择使用 CGLIB。</p>
<ul>
<li>CglibProxy.java</li>
</ul>
<pre><code class="java">public class CglibProxy implements MethodInterceptor {

    @Override
    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
        int times = 0;

        while (times &lt; RetryConstant.MAX_TIMES) {
            try {
                //通过代理子类调用父类的方法
                return methodProxy.invokeSuper(o, objects);
            } catch (Exception e) {
                times++;

                if (times &gt;= RetryConstant.MAX_TIMES) {
                    throw new RuntimeException(e);
                }
            }
        }

        return null;
    }

    /**
     * 获取代理类
     * @param clazz 类信息
     * @return 代理类结果
     */
    public Object getProxy(Class clazz){
        Enhancer enhancer = new Enhancer();
        //目标对象类
        enhancer.setSuperclass(clazz);
        enhancer.setCallback(this);
        //通过字节码技术创建目标对象类的子类实例作为代理
        return enhancer.create();
    }

}</code></pre>
<p>测试</p>
<pre><code class="java">@Test
public void failUserServiceTest() {
   UserService proxyService = (UserService) new CglibProxy().getProxy(UserServiceImpl.class);

   User user = proxyService.queryUser(new QueryUserCondition());
   LOGGER.info(&quot;failUserServiceTest: &quot; + user);
}

@Test
public void resourceServiceTest() {
   ResourceServiceImpl proxyService = (ResourceServiceImpl) new CglibProxy().getProxy(ResourceServiceImpl.class);
   boolean result = proxyService.checkResource(new User());
   LOGGER.info(&quot;resourceServiceTest: &quot; + result);
}</code></pre>
<h3 id="V2-0-AOP-实现"><a href="#V2-0-AOP-实现" class="headerlink" title="V2.0 AOP 实现"></a>V2.0 AOP 实现</h3><p>对话</p>
<p>项目经理：小明啊，最近我在想一个问题。不同的服务，重试的时候次数应该是不同的。因为服务对稳定性的要求各不相同啊。</p>
<p>小明：好的。(心想，重试都搞了一周了，今天都周五了。)</p>
<p>下班之前，小明一直在想这个问题。刚好周末，花点时间写个重试小工具吧。</p>
<p>设计思路</p>
<p>技术支持</p>
<p>spring</p>
<p>java 注解</p>
<p>注解定义<br>注解可在方法上使用，定义需要重试的次数</p>
<p>注解解析<br>拦截指定需要重试的方法，解析对应的重试次数，然后进行对应次数的重试。</p>
<p>实现</p>
<ul>
<li><p>Retryable.java</p>
<pre><code class="java">@Target({ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Retryable {

  /**
   * Exception type that are retryable.
   * @return exception type to retry
   */
  Class&lt;? extends Throwable&gt; value() default RuntimeException.class;

  /**
   * 包含第一次失败
   * @return the maximum number of attempts (including the first failure), defaults to 3
   */
  int maxAttempts() default 3;
</code></pre>
</li>
</ul>
<p>}</p>
<pre><code>
- RetryAspect.java

```java
@Aspect
@Component
public class RetryAspect {

    @Pointcut(&quot;execution(public * com.github.houbb.retry.aop..*.*(..)) &amp;&amp;&quot; +
                      &quot;@annotation(com.github.houbb.retry.aop.annotation.Retryable)&quot;)
    public void myPointcut() {
    }

    @Around(&quot;myPointcut()&quot;)
    public Object around(ProceedingJoinPoint point) throws Throwable {
        Method method = getCurrentMethod(point);
        Retryable retryable = method.getAnnotation(Retryable.class);

        //1. 最大次数判断
        int maxAttempts = retryable.maxAttempts();
        if (maxAttempts &lt;= 1) {
            return point.proceed();
        }

        //2. 异常处理
        int times = 0;
        final Class&lt;? extends Throwable&gt; exceptionClass = retryable.value();
        while (times &lt; maxAttempts) {
            try {
                return point.proceed();
            } catch (Throwable e) {
                times++;

                // 超过最大重试次数 or 不属于当前处理异常
                if (times &gt;= maxAttempts ||
                        !e.getClass().isAssignableFrom(exceptionClass)) {
                    throw new Throwable(e);
                }
            }
        }

        return null;
    }

    private Method getCurrentMethod(ProceedingJoinPoint point) {
        try {
            Signature sig = point.getSignature();
            MethodSignature msig = (MethodSignature) sig;
            Object target = point.getTarget();
            return target.getClass().getMethod(msig.getName(), msig.getParameterTypes());
        } catch (NoSuchMethodException e) {
            throw new RuntimeException(e);
        }
    }

}</code></pre><p>方法的使用</p>
<p>fiveTimes()<br>当前方法一共重试 5 次。<br>重试条件：服务抛出 AopRuntimeExption</p>
<pre><code class="java">@Override
@Retryable(maxAttempts = 5, value = AopRuntimeExption.class)
public void fiveTimes() {
    LOGGER.info(&quot;fiveTimes called!&quot;);
    throw new AopRuntimeExption();
}</code></pre>
<p>测试日志</p>
<pre><code class="console">2018-08-08 15:49:33.814  INFO  [main] com.github.houbb.retry.aop.service.impl.UserServiceImpl:66 - fiveTimes called!
2018-08-08 15:49:33.815  INFO  [main] com.github.houbb.retry.aop.service.impl.UserServiceImpl:66 - fiveTimes called!
2018-08-08 15:49:33.815  INFO  [main] com.github.houbb.retry.aop.service.impl.UserServiceImpl:66 - fiveTimes called!
2018-08-08 15:49:33.815  INFO  [main] com.github.houbb.retry.aop.service.impl.UserServiceImpl:66 - fiveTimes called!
2018-08-08 15:49:33.815  INFO  [main] com.github.houbb.retry.aop.service.impl.UserServiceImpl:66 - fiveTimes called!

java.lang.reflect.UndeclaredThrowableException
...</code></pre>
<h3 id="V3-0-spring-retry-版本"><a href="#V3-0-spring-retry-版本" class="headerlink" title="V3.0 spring-retry 版本"></a>V3.0 spring-retry 版本</h3><p>对话</p>
<p>周一来到公司，项目经理又和小明谈了起来。</p>
<p>项目经理：重试次数是满足了，但是重试其实应该讲究策略。比如调用外部，第一次失败，可以等待 5S 在次调用，如果又失败了，可以等待 10S 再调用。。。</p>
<p>小明：了解。</p>
<p>思考</p>
<p>可是今天周一，还有其他很多事情要做。</p>
<p>小明在想，没时间写这个呀。看看网上有没有现成的。</p>
<p>spring-retry</p>
<p>Spring Retry 为 Spring 应用程序提供了声明性重试支持。 它用于Spring批处理、Spring集成、Apache Hadoop(等等)的Spring。</p>
<p>在分布式系统中，为了保证数据分布式事务的强一致性，大家在调用RPC接口或者发送MQ时，针对可能会出现网络抖动请求超时情况采取一下重试操作。 大家用的最多的重试方式就是MQ了，但是如果你的项目中没有引入MQ，那就不方便了。</p>
<p>还有一种方式，是开发者自己编写重试机制，但是大多不够优雅。</p>
<p>注解式使用<br>RemoteService.java<br>重试条件：遇到 RuntimeException</p>
<p>重试次数：3</p>
<p>重试策略：重试的时候等待 5S, 后面时间依次变为原来的 2 倍数。</p>
<p>熔断机制：全部重试失败，则调用 recover() 方法。</p>
<pre><code class="java">@Service
public class RemoteService {

    private static final Logger LOGGER = LoggerFactory.getLogger(RemoteService.class);

    /**
     * 调用方法
     */
    @Retryable(value = RuntimeException.class,
               maxAttempts = 3,
               backoff = @Backoff(delay = 5000L, multiplier = 2))
    public void call() {
        LOGGER.info(&quot;Call something...&quot;);
        throw new RuntimeException(&quot;RPC调用异常&quot;);
    }

    /**
     * recover 机制
     * @param e 异常
     */
    @Recover
    public void recover(RuntimeException e) {
        LOGGER.info(&quot;Start do recover things....&quot;);
        LOGGER.warn(&quot;We meet ex: &quot;, e);
    }

}</code></pre>
<p>测试</p>
<pre><code class="java">@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)
public class RemoteServiceTest {

    @Autowired
    private RemoteService remoteService;

    @Test
    public void test() {
        remoteService.call();
    }

}</code></pre>
<p>日志</p>
<pre><code>2018-08-08 16:03:26.409  INFO 1433 --- [           main] c.g.h.r.spring.service.RemoteService     : Call something...
2018-08-08 16:03:31.414  INFO 1433 --- [           main] c.g.h.r.spring.service.RemoteService     : Call something...
2018-08-08 16:03:41.416  INFO 1433 --- [           main] c.g.h.r.spring.service.RemoteService     : Call something...
2018-08-08 16:03:41.418  INFO 1433 --- [           main] c.g.h.r.spring.service.RemoteService     : Start do recover things....
2018-08-08 16:03:41.425  WARN 1433 --- [           main] c.g.h.r.spring.service.RemoteService     : We meet ex: 

java.lang.RuntimeException: RPC调用异常
    at com.github.houbb.retry.spring.service.RemoteService.call(RemoteService.java:38) ~[classes/:na]
...</code></pre><p>三次调用的时间点：</p>
<p>2018-08-08 16:03:26.409 </p>
<p>2018-08-08 16:03:31.414</p>
<p>2018-08-08 16:03:41.416</p>
<p>缺陷</p>
<p>spring-retry 工具虽能优雅实现重试，但是存在两个不友好设计：</p>
<p>一个是重试实体限定为 Throwable 子类，说明重试针对的是可捕捉的功能异常为设计前提的，但是我们希望依赖某个数据对象实体作为重试实体，但sping-retry框架必须强制转换为Throwable子类。</p>
<p>另一个就是重试根源的断言对象使用的是 doWithRetry 的 Exception 异常实例，不符合正常内部断言的返回设计。</p>
<p>Spring Retry 提倡以注解的方式对方法进行重试，重试逻辑是同步执行的，重试的“失败”针对的是Throwable，<br>如果你要以返回值的某个状态来判定是否需要重试，可能只能通过自己判断返回值然后显式抛出异常了。</p>
<p>@Recover 注解在使用时无法指定方法，如果一个类中多个重试方法，就会很麻烦。</p>
<p>注解介绍</p>
<ul>
<li>@EnableRetry</li>
</ul>
<p>表示是否开始重试。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>属性</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>proxyTargetClass</td>
<td>boolean</td>
<td>false</td>
<td>指示是否要创建基于子类的(CGLIB)代理，而不是创建标准的基于Java接口的代理。</td>
</tr>
</tbody></table>
<ul>
<li>@Retryable</li>
</ul>
<p>标注此注解的方法在发生异常时会进行重试</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>属性</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>interceptor</td>
<td>String</td>
<td>“”</td>
<td>将interceptor的bean名称应用到retryable()</td>
</tr>
<tr>
<td>2</td>
<td>value</td>
<td>Class[]</td>
<td>{}</td>
<td>可重试的异常类型。</td>
</tr>
<tr>
<td>3</td>
<td>label</td>
<td>String</td>
<td>“”</td>
<td>统计报告的唯一标签。如果没有提供，调用者可以选择忽略它，或者提供默认值。</td>
</tr>
<tr>
<td>4</td>
<td>maxAttempts</td>
<td>int</td>
<td>3</td>
<td>尝试的最大次数(包括第一次失败)，默认为3次。</td>
</tr>
<tr>
<td>5</td>
<td>backoff</td>
<td>@Backoff</td>
<td>@Backoff()</td>
<td>指定用于重试此操作的backoff属性。默认为空</td>
</tr>
</tbody></table>
<ul>
<li>@Backoff</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>属性</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>delay</td>
<td>long</td>
<td>0</td>
<td>如果不设置则默认使用1000milliseconds重试等待</td>
</tr>
<tr>
<td>2</td>
<td>maxDelay</td>
<td>long</td>
<td>0</td>
<td>最大重试等待时间</td>
</tr>
<tr>
<td>3</td>
<td>multiplier</td>
<td>long</td>
<td>0</td>
<td>用于计算下一个延迟延迟的乘数(大于0生效)</td>
</tr>
<tr>
<td>4</td>
<td>random</td>
<td>boolean</td>
<td>false</td>
<td>随机重试等待时间</td>
</tr>
</tbody></table>
<ul>
<li>@Recover</li>
</ul>
<p>用于恢复处理程序的方法调用的注释。一个合适的复苏handler有一个类型为可投掷(或可投掷的子类型)的第一个参数和返回与<code>@Retryable</code>方法相同的类型的值。可抛出的第一个参数是可选的(但是没有它的方法只会被调用)。从失败方法的参数列表按顺序填充后续的参数。</p>
<h3 id="方法式使用"><a href="#方法式使用" class="headerlink" title="方法式使用"></a>方法式使用</h3><p>注解式只是让我们使用更加便捷，但是如果要更高的灵活性。可以使用各种提供的方法。</p>
<ul>
<li>SimpleDemo.java</li>
</ul>
<pre><code class="java">public class SimpleDemo {

    private static final Logger LOGGER = LoggerFactory.getLogger(SimpleDemo.class);

    public static void main(String[] args) throws Exception {
        RetryTemplate template = new RetryTemplate();

        // 策略
        SimpleRetryPolicy policy = new SimpleRetryPolicy();
        policy.setMaxAttempts(2);
        template.setRetryPolicy(policy);

        String result = template.execute(
                new RetryCallback&lt;String, Exception&gt;() {
                    @Override
                    public String doWithRetry(RetryContext arg0) {
                        throw new NullPointerException();
                    }
                }
                ,
                new RecoveryCallback&lt;String&gt;() {
                    @Override
                    public String recover(RetryContext context) {
                        return &quot;recovery callback&quot;;
                    }
                }
        );

        LOGGER.info(&quot;result: {}&quot;, result);
    }

}</code></pre>
<p>执行日志</p>
<pre><code class="console">16:30:52.578 [main] DEBUG org.springframework.retry.support.RetryTemplate - Retry: count=0
16:30:52.591 [main] DEBUG org.springframework.retry.support.RetryTemplate - Checking for rethrow: count=1
16:30:52.591 [main] DEBUG org.springframework.retry.support.RetryTemplate - Retry: count=1
16:30:52.591 [main] DEBUG org.springframework.retry.support.RetryTemplate - Checking for rethrow: count=2
16:30:52.591 [main] DEBUG org.springframework.retry.support.RetryTemplate - Retry failed last attempt: count=2
16:30:52.592 [main] INFO com.github.houbb.retry.spring.commonway.SimpleDemo - result: recovery callback</code></pre>
<h3 id="spring-retry-结构"><a href="#spring-retry-结构" class="headerlink" title="spring-retry 结构"></a>spring-retry 结构</h3><p>概览</p>
<ul>
<li><p>RetryCallback: 封装你需要重试的业务逻辑（上文中的doSth）</p>
</li>
<li><p>RecoverCallback：封装在多次重试都失败后你需要执行的业务逻辑(上文中的doSthWhenStillFail)</p>
</li>
<li><p>RetryContext: 重试语境下的上下文，可用于在多次Retry或者Retry 和Recover之间传递参数或状态（在多次doSth或者doSth与doSthWhenStillFail之间传递参数）</p>
</li>
<li><p>RetryOperations : 定义了“重试”的基本框架（模板），要求传入RetryCallback，可选传入RecoveryCallback；</p>
</li>
<li><p>RetryListener：典型的“监听者”，在重试的不同阶段通知“监听者”（例如doSth，wait等阶段时通知）</p>
</li>
<li><p>RetryPolicy : 重试的策略或条件，可以简单的进行多次重试，可以是指定超时时间进行重试（上文中的someCondition）</p>
</li>
<li><p>BackOffPolicy: 重试的回退策略，在业务逻辑执行发生异常时。如果需要重试，我们可能需要等一段时间(可能服务器过于繁忙，如果一直不间隔重试可能拖垮服务器)，当然这段时间可以是 0，也可以是固定的，可以是随机的（参见tcp的拥塞控制算法中的回退策略）。回退策略在上文中体现为wait()；</p>
</li>
<li><p>RetryTemplate: RetryOperations的具体实现，组合了RetryListener[]，BackOffPolicy，RetryPolicy。<br>重试策略</p>
</li>
<li><p>NeverRetryPolicy：只允许调用RetryCallback一次，不允许重试</p>
</li>
<li><p>AlwaysRetryPolicy：允许无限重试，直到成功，此方式逻辑不当会导致死循环</p>
</li>
<li><p>SimpleRetryPolicy：固定次数重试策略，默认重试最大次数为3次，RetryTemplate默认使用的策略</p>
</li>
<li><p>TimeoutRetryPolicy：超时时间重试策略，默认超时时间为1秒，在指定的超时时间内允许重试</p>
</li>
<li><p>ExceptionClassifierRetryPolicy：设置不同异常的重试策略，类似组合重试策略，区别在于这里只区分不同异常的重试</p>
</li>
<li><p>CircuitBreakerRetryPolicy：有熔断功能的重试策略，需设置3个参数openTimeout、resetTimeout和delegate</p>
</li>
<li><p>CompositeRetryPolicy：组合重试策略，有两种组合方式，乐观组合重试策略是指只要有一个策略允许重试即可以，悲观组合重试策略是指只要有一个策略不允许重试即可以，但不管哪种组合方式，组合中的每一个策略都会执行重试回退策略。重试回退策略，指的是每次重试是立即重试还是等待一段时间后重试。默认情况下是立即重试，如果需要配置等待一段时间后重试则需要指定回退策略BackoffRetryPolicy。</p>
</li>
<li><p>NoBackOffPolicy：无退避算法策略，每次重试时立即重试</p>
</li>
<li><p>FixedBackOffPolicy：固定时间的退避策略，需设置参数sleeper和backOffPeriod，sleeper指定等待策略，默认是Thread.sleep，即线程休眠，backOffPeriod指定休眠时间，默认1秒</p>
</li>
<li><p>UniformRandomBackOffPolicy：随机时间退避策略，需设置sleeper、minBackOffPeriod和maxBackOffPeriod，该策略在[minBackOffPeriod,maxBackOffPeriod之间取一个随机休眠时间，minBackOffPeriod默认500毫秒，maxBackOffPeriod默认1500毫秒</p>
</li>
<li><p>ExponentialBackOffPolicy：指数退避策略，需设置参数sleeper、initialInterval、maxInterval和multiplier，initialInterval指定初始休眠时间，默认100毫秒，maxInterval指定最大休眠时间，默认30秒，multiplier指定乘数，即下一次休眠时间为当前休眠时间*multiplier</p>
</li>
<li><p>ExponentialRandomBackOffPolicy：随机指数退避策略，引入随机乘数可以实现随机乘数回退</p>
</li>
</ul>
<h3 id="guava-retrying"><a href="#guava-retrying" class="headerlink" title="guava-retrying"></a>guava-retrying</h3><p>谈话</p>
<p>小华：我们系统也要用到重试</p>
<p>项目经理：小明前段时间用了 spring-retry，分享下应该还不错</p>
<p>小明：spring-retry 基本功能都有，但是必须是基于异常来进行控制。如果你要以返回值的某个状态来判定是否需要重试，可能只能通过自己判断返回值然后显式抛出异常了。</p>
<p>小华：我们项目中想根据对象的属性来进行重试。你可以看下 guava-retry，我很久以前用过，感觉还不错。</p>
<p>小明：好的。</p>
<h4 id="guava-retrying-1"><a href="#guava-retrying-1" class="headerlink" title="guava-retrying"></a>guava-retrying</h4><p>guava-retrying 模块提供了一种通用方法， 可以使用Guava谓词匹配增强的特定停止、重试和异常处理功能来重试任意Java代码。</p>
<p>优势</p>
<p>guava retryer工具与spring-retry类似，都是通过定义重试者角色来包装正常逻辑重试，但是Guava retryer有更优的策略定义，在支持重试次数和重试频度控制基础上，能够兼容支持多个异常或者自定义实体对象的重试源定义，让重试功能有更多的灵活性。</p>
<p>Guava Retryer也是线程安全的，入口调用逻辑采用的是 java.util.concurrent.Callable 的 call() 方法</p>
<p>代码例子</p>
<p>入门案例</p>
<p>遇到异常之后，重试 3 次停止</p>
<ul>
<li>HelloDemo.java</li>
</ul>
<pre><code class="java">public static void main(String[] args) {
    Callable&lt;Boolean&gt; callable = new Callable&lt;Boolean&gt;() {
        @Override
        public Boolean call() throws Exception {
            // do something useful here
            LOGGER.info(&quot;call...&quot;);
            throw new RuntimeException();
        }
    };

    Retryer&lt;Boolean&gt; retryer = RetryerBuilder.&lt;Boolean&gt;newBuilder()
            .retryIfResult(Predicates.isNull())
            .retryIfExceptionOfType(IOException.class)
            .retryIfRuntimeException()
            .withStopStrategy(StopStrategies.stopAfterAttempt(3))
            .build();
    try {
        retryer.call(callable);
    } catch (RetryException | ExecutionException e) {
        e.printStackTrace();
    }

}</code></pre>
<p>日志</p>
<pre><code class="console">2018-08-08 17:21:12.442  INFO  [main] com.github.houbb.retry.guava.HelloDemo:41 - call...
com.github.rholder.retry.RetryException: Retrying failed to complete successfully after 3 attempts.
2018-08-08 17:21:12.443  INFO  [main] com.github.houbb.retry.guava.HelloDemo:41 - call...
2018-08-08 17:21:12.444  INFO  [main] com.github.houbb.retry.guava.HelloDemo:41 - call...
    at com.github.rholder.retry.Retryer.call(Retryer.java:174)
    at com.github.houbb.retry.guava.HelloDemo.main(HelloDemo.java:53)
Caused by: java.lang.RuntimeException
    at com.github.houbb.retry.guava.HelloDemo$1.call(HelloDemo.java:42)
    at com.github.houbb.retry.guava.HelloDemo$1.call(HelloDemo.java:37)
    at com.github.rholder.retry.AttemptTimeLimiters$NoAttemptTimeLimit.call(AttemptTimeLimiters.java:78)
    at com.github.rholder.retry.Retryer.call(Retryer.java:160)
    ... 1 more</code></pre>
<p>重试策略</p>
<p>ExponentialBackoff.java</p>
<p>重试次数：3</p>
<p>重试策略：固定等待 3S</p>
<pre><code class="java">Retryer&lt;Boolean&gt; retryer = RetryerBuilder.&lt;Boolean&gt;newBuilder()
                .retryIfResult(Predicates.isNull())
                .retryIfExceptionOfType(IOException.class)
                .retryIfRuntimeException()
                .withWaitStrategy(WaitStrategies.fixedWait(3, TimeUnit.SECONDS))
                .withStopStrategy(StopStrategies.stopAfterAttempt(3))
                .build();
        try {
            retryer.call(callable);
        } catch (RetryException | ExecutionException e) {
            e.printStackTrace();
        }</code></pre>
<p>日志</p>
<pre><code class="console">2018-08-08 17:20:41.653  INFO  [main] com.github.houbb.retry.guava.ExponentialBackoff:43 - call...
2018-08-08 17:20:44.659  INFO  [main] com.github.houbb.retry.guava.ExponentialBackoff:43 - call...
2018-08-08 17:20:47.664  INFO  [main] com.github.houbb.retry.guava.ExponentialBackoff:43 - call...
com.github.rholder.retry.RetryException: Retrying failed to complete successfully after 3 attempts.
    at com.github.rholder.retry.Retryer.call(Retryer.java:174)
    at com.github.houbb.retry.guava.ExponentialBackoff.main(ExponentialBackoff.java:56)
Caused by: java.lang.RuntimeException
    at com.github.houbb.retry.guava.ExponentialBackoff$1.call(ExponentialBackoff.java:44)
    at com.github.houbb.retry.guava.ExponentialBackoff$1.call(ExponentialBackoff.java:39)
    at com.github.rholder.retry.AttemptTimeLimiters$NoAttemptTimeLimit.call(AttemptTimeLimiters.java:78)
    at com.github.rholder.retry.Retryer.call(Retryer.java:160)
    ... 1 more</code></pre>
<h4 id="guava-retrying-简介"><a href="#guava-retrying-简介" class="headerlink" title="guava-retrying 简介"></a>guava-retrying 简介</h4><ul>
<li><p>RetryerBuilder RetryerBuilder 是一个 factory 创建者，可以定制设置重试源且可以支持多个重试源，可以配置重试次数或重试超时时间，以及可以配置等待时间间隔，创建重试者 Retryer 实例。RetryerBuilder 的重试源支持 Exception 异常对象和自定义断言对象，通过retryIfException 和 retryIfResult 设置，同时支持多个且能兼容。</p>
</li>
<li><p>retryIfException retryIfException，抛出 runtime 异常、checked 异常时都会重试，但是抛出 error 不会重试。</p>
</li>
<li><p>retryIfRuntimeException retryIfRuntimeException 只会在抛 runtime 异常的时候才重试，checked 异常和error 都不重试。</p>
</li>
<li><p>retryIfExceptionOfType retryIfExceptionOfType 允许我们只在发生特定异常的时候才重试，比如NullPointerException 和 IllegalStateException 都属于 runtime 异常，也包括自定义的error。</p>
</li>
</ul>
<p>如：　　</p>
<pre><code class="java">retryIfExceptionOfType(Error.class)// 只在抛出error重试</code></pre>
<p>当然我们还可以在只有出现指定的异常的时候才重试，如：　</p>
<pre><code class="java">.retryIfExceptionOfType(IllegalStateException.class)
.retryIfExceptionOfType(NullPointerException.class)</code></pre>
<p>或者通过Predicate实现</p>
<pre><code class="java">.retryIfException(Predicates.or(Predicates.instanceOf(NullPointerException.class),
Predicates.instanceOf(IllegalStateException.class))) </code></pre>
<ul>
<li>retryIfResult retryIfResult 可以指定你的 Callable 方法在返回值的时候进行重试，如　　</li>
</ul>
<pre><code class="java">// 返回false重试  
.retryIfResult(Predicates.equalTo(false))   

//以_error结尾才重试  
.retryIfResult(Predicates.containsPattern(&quot;_error$&quot;))  </code></pre>
<ul>
<li>RetryListener 当发生重试之后，假如我们需要做一些额外的处理动作，比如log一下异常，那么可以使用RetryListener。每次重试之后，guava-retrying 会自动回调我们注册的监听。可以注册多个RetryListener，会按照注册顺序依次调用。 　</li>
</ul>
<pre><code class="java">.withRetryListener(new RetryListener {      
 @Override    
   public &lt;T&gt; void onRetry(Attempt&lt;T&gt; attempt) {  
               logger.error(&quot;第【{}】次调用失败&quot; , attempt.getAttemptNumber());  
          } 
 }
) </code></pre>
<p>主要接口</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>接口</th>
<th>描述</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Attempt</td>
<td>一次执行任务</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>AttemptTimeLimiter</td>
<td>单次任务执行时间限制</td>
<td>如果单次任务执行超时，则终止执行当前任务</td>
</tr>
<tr>
<td>3</td>
<td>BlockStrategies</td>
<td>任务阻塞策略</td>
<td>通俗的讲就是当前任务执行完，下次任务还没开始这段时间做什么），默认策略为：BlockStrategies.THREAD_SLEEP_STRATEGY</td>
</tr>
<tr>
<td>4</td>
<td>RetryException</td>
<td>重试异常</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>RetryListener</td>
<td>自定义重试监听器</td>
<td>可以用于异步记录错误日志</td>
</tr>
<tr>
<td>6</td>
<td>StopStrategy</td>
<td>停止重试策略</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>WaitStrategy</td>
<td>等待时长策略</td>
<td>（控制时间间隔），返回结果为下次执行时长</td>
</tr>
<tr>
<td>8</td>
<td>Attempt</td>
<td>一次执行任务</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>Attempt</td>
<td>一次执行任务</td>
<td></td>
</tr>
</tbody></table>
<p>StopStrategy</p>
<p>提供三种：</p>
<ul>
<li><p>StopAfterDelayStrategy 设定一个最长允许的执行时间；比如设定最长执行10s，无论任务执行次数，只要重试的时候超出了最长时间，则任务终止，并返回重试异常RetryException；</p>
</li>
<li><p>NeverStopStrategy 不停止，用于需要一直轮训知道返回期望结果的情况；</p>
</li>
<li><p>StopAfterAttemptStrategy 设定最大重试次数，如果超出最大重试次数则停止重试，并返回重试异常；</p>
</li>
</ul>
<p>WaitStrategy</p>
<ul>
<li><p>FixedWaitStrategy 固定等待时长策略；</p>
</li>
<li><p>RandomWaitStrategy 随机等待时长策略（可以提供一个最小和最大时长，等待时长为其区间随机值）</p>
</li>
<li><p>IncrementingWaitStrategy 递增等待时长策略（提供一个初始值和步长，等待时间随重试次数增加而增加）</p>
</li>
<li><p>ExponentialWaitStrategy 指数等待时长策略；</p>
</li>
<li><p>FibonacciWaitStrategy Fibonacci 等待时长策略；</p>
</li>
<li><p>ExceptionWaitStrategy 异常时长等待策略；</p>
</li>
<li><p>CompositeWaitStrategy 复合时长等待策略；</p>
</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>优雅重试共性和原理</li>
</ol>
<p>正常和重试优雅解耦，重试断言条件实例或逻辑异常实例是两者沟通的媒介。</p>
<p>约定重试间隔，差异性重试策略，设置重试超时时间，进一步保证重试有效性以及重试流程稳定性。</p>
<p>都使用了命令设计模式，通过委托重试对象完成相应的逻辑操作，同时内部封装实现重试逻辑。</p>
<p>spring-retry 和 guava-retry 工具都是线程安全的重试，能够支持并发业务场景的重试逻辑正确性。</p>
<ol start="2">
<li>优雅重试适用场景</li>
</ol>
<p>功能逻辑中存在不稳定依赖场景，需要使用重试获取预期结果或者尝试重新执行逻辑不立即结束。比如远程接口访问，数据加载访问，数据上传校验等等。</p>
<p>对于异常场景存在需要重试场景，同时希望把正常逻辑和重试逻辑解耦。</p>
<p>对于需要基于数据媒介交互，希望通过重试轮询检测执行逻辑场景也可以考虑重试方案。</p>
<p>谈话</p>
<p>项目经理：我觉得 guava-retry 挺好的，就是不够方便。小明啊，你给封装个基于注解的吧。</p>
<p>小明：……</p>
<p>更好的实现:</p>
<p><a href="https://github.com/houbb/sisyphus" target="_blank" rel="noopener">java重试框架——sisyphus</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 kongzheng1993@hotmail.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Java Retry</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">6.5k</span></p>
    <p><span class="copy-title">本文作者:</span><a  title="evilRat">evilRat</a></p>
    <p><span class="copy-title">发布时间:</span>2021-03-29, 19:30:52</p>
    <p><span class="copy-title">最后更新:</span>2022-02-25, 15:46:31</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2021/03/29/kongzheng1993-JavaRetry/" title="Java Retry">https://kongzheng1993.github.io/2021/03/29/kongzheng1993-JavaRetry/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '8eb9176cf9a501aa08df',
            clientSecret: '6eb3cbb91e811217972e3adac41fd47881aa5b58',
            repo: 'kongzheng1993.github.io',
            owner: 'kongzheng1993',
            admin: ['kongzheng1993'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2020 Evil</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.png" class="alipay" title="扫码支持">
            <img src="/img/weixin.png" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#oop','#float','#servlet','#sample post','#images','#test','#String','#new','#catch，try','#sys','#sqlplus','#sql','#re','#oracle','#github','#hexo','#git','#java','#reflect','#Class','#对象，Class对象','#select','#distinct','#group by','#order by','#linux','#ss','#console','#suse','#server','#FTP','#mq','#消息队列','#编码','#Linux','#RSA','#SHA','#加密','#签名','#quartz','#锁','#分布式','#mysql','#备份','#NIO BIO IO','#职业','#业务','#学习','#Guava','#Java','#jvm','#MQ','#other','#node.js','#Web','#RocketMQ','#Mysql','#SQL','#多线程','#算法','#tools','#MySQL','#others','#Ohters','#maven','#AI','#blog','#vue','#Spring','#JavaScript','#SpringBoot','#JDK','#分页','#Windows','#杂谈','#JVM','#resume','#简历','#jdk','#SpringCloud','#感悟','#Spring Cloud','#网络','#Nginx','#并发','#MongoDB','#spring','#安全',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
    .post .pjax article :not(pre) > code {
        color: #24292e;
        font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
        font-size: 85%;
        margin: 0;
        padding: .2em .4em;
    }
    
</style>







</html>
